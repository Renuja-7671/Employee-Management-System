# Hostinger Cron Job Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      HOSTINGER SERVER                               â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Hostinger Cron Service                          â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚   Cron Job 1   â”‚  â”‚   Cron Job 2   â”‚  â”‚  Cron Job 3   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                â”‚  â”‚                â”‚  â”‚               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ 0 * * * *      â”‚  â”‚ 0 5 * * *      â”‚  â”‚ 0 0 1 * *     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ (Every Hour)   â”‚  â”‚ (Daily 5 AM)   â”‚  â”‚ (Monthly)     â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚           â”‚                   â”‚                   â”‚         â”‚ â”‚
â”‚  â”‚           â”‚ curl GET          â”‚ curl GET          â”‚ curl    â”‚ â”‚
â”‚  â”‚           â”‚ + Auth Header     â”‚ + Auth Header     â”‚ + Auth  â”‚ â”‚
â”‚  â”‚           â–¼                   â–¼                   â–¼         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â”‚                   â”‚                   â”‚           â”‚
â”‚              â”‚                   â”‚                   â”‚           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  Next.js Application                        â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚            API Routes                                 â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  /api/cron/cleanup-expired-covers                    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Verify CRON_SECRET                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Find expired cover requests                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Delete leave + cover request                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Create employee notification                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ Return summary                                   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  /api/emails/birthday/auto                           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Verify CRON_SECRET                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Find today's birthdays                           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Send birthday emails                             â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ Return summary                                   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  /api/cron/sync-holidays                             â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Verify CRON_SECRET                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Fetch from Calendarific API                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Update database                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ Return summary                                   â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                              â”‚                               â”‚ â”‚
â”‚  â”‚                              â–¼                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚              PostgreSQL Database                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Leave   â”‚  â”‚  Cover   â”‚  â”‚  Notification      â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚          â”‚  â”‚ Request  â”‚  â”‚                    â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Hostinger Cron Job â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ curl -H "Authorization: Bearer SECRET"
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         API Endpoint Handler              â”‚
â”‚                                           â”‚
â”‚  1. Extract Authorization header          â”‚
â”‚  2. Get CRON_SECRET from env             â”‚
â”‚  3. Compare: header === `Bearer ${secret}`â”‚
â”‚                                           â”‚
â”‚     â”Œâ”€â”€â”€ Match? â”€â”€â”€â”                     â”‚
â”‚     â”‚              â”‚                     â”‚
â”‚    YES             NO                    â”‚
â”‚     â”‚              â”‚                     â”‚
â”‚     â–¼              â–¼                     â”‚
â”‚  Execute      Return 401                 â”‚
â”‚  Cron Job     Unauthorized               â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚              â”‚ Log attempt  â”‚            â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow: Expired Cover Cleanup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cron Runs   â”‚ Every hour at :00
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Query Database: Find Expired Cover Requests             â”‚
â”‚                                                          â”‚
â”‚ SELECT * FROM CoverRequest                               â”‚
â”‚ WHERE status = 'PENDING'                                 â”‚
â”‚   AND expiresAt < NOW()                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ For Each Expired Request:                               â”‚
â”‚                                                          â”‚
â”‚  1. Get Leave Details                                    â”‚
â”‚     â”œâ”€ Employee info (firstName, lastName, email)       â”‚
â”‚     â”œâ”€ Leave dates (startDate, endDate)                 â”‚
â”‚     â””â”€ Cover employee info                              â”‚
â”‚                                                          â”‚
â”‚  2. Create Notification                                  â”‚
â”‚     â”œâ”€ Type: SYSTEM_ALERT                               â”‚
â”‚     â”œâ”€ Title: "âŒ Leave Request Expired"                â”‚
â”‚     â”œâ”€ Message: Details about expiry                    â”‚
â”‚     â””â”€ isPinned: true                                   â”‚
â”‚                                                          â”‚
â”‚  3. Delete Leave Record                                  â”‚
â”‚     â””â”€ (Cascade deletes CoverRequest)                   â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Return Summary                                           â”‚
â”‚                                                          â”‚
â”‚ {                                                        â”‚
â”‚   "success": true,                                       â”‚
â”‚   "summary": {                                           â”‚
â”‚     "totalExpired": 3,                                   â”‚
â”‚     "successfullyCleaned": 3,                            â”‚
â”‚     "notificationsSent": 3,                              â”‚
â”‚     "errors": 0                                          â”‚
â”‚   }                                                      â”‚
â”‚ }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Timeline Example

```
Day 1
â”€â”€â”€â”€â”€
09:00 AM â”‚ Employee applies for leave
         â”‚ Status: PENDING_COVER
         â”‚ Cover request created with expiresAt = 09:00 PM (12 hours)
         â”‚
09:00 PM â”‚ â° Cover request expires (12 hours passed)
         â”‚ Cover employee never responded
         â”‚
10:00 PM â”‚ ğŸ¤– Cron job runs (top of the hour)
         â”‚ â”œâ”€ Finds expired cover request
         â”‚ â”œâ”€ Notifies employee: "Request expired"
         â”‚ â”œâ”€ Deletes leave request
         â”‚ â””â”€ Deletes cover request (cascade)
         â”‚
         â”‚ âœ… Cover employee now available again
         â”‚ âœ… Employee can reapply if needed
         â”‚ âœ… System is clean

Day 2
â”€â”€â”€â”€â”€
08:00 AM â”‚ Employee reapplies for same leave
         â”‚ Fresh 12-hour window starts
         â”‚ New cover request created
```

## Monitoring Dashboard (Visual)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘               CRON JOB MONITORING                        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                          â•‘
â•‘  Cron Job 1: Cleanup Expired Covers                     â•‘
â•‘  â”œâ”€ Last Run: 2026-01-29 10:00:00                       â•‘
â•‘  â”œâ”€ Status: âœ… Success                                   â•‘
â•‘  â”œâ”€ Expired Found: 2                                     â•‘
â•‘  â”œâ”€ Cleaned: 2                                           â•‘
â•‘  â””â”€ Next Run: 2026-01-29 11:00:00                       â•‘
â•‘                                                          â•‘
â•‘  Cron Job 2: Birthday Emails                            â•‘
â•‘  â”œâ”€ Last Run: 2026-01-29 05:00:00                       â•‘
â•‘  â”œâ”€ Status: âœ… Success                                   â•‘
â•‘  â”œâ”€ Emails Sent: 3                                       â•‘
â•‘  â””â”€ Next Run: 2026-01-30 05:00:00                       â•‘
â•‘                                                          â•‘
â•‘  Cron Job 3: Holiday Sync                               â•‘
â•‘  â”œâ”€ Last Run: 2026-01-01 00:00:00                       â•‘
â•‘  â”œâ”€ Status: âœ… Success                                   â•‘
â•‘  â”œâ”€ Holidays Updated: 15                                 â•‘
â•‘  â””â”€ Next Run: 2026-02-01 00:00:00                       â•‘
â•‘                                                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## Environment Variables Setup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Hostinger hPanel                           â”‚
â”‚                                                         â”‚
â”‚  Advanced â†’ Environment Variables                      â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Variable Name:  CRON_SECRET                     â”‚  â”‚
â”‚  â”‚ Variable Value: a7f3e9d2c4b8...                 â”‚  â”‚
â”‚  â”‚                                                  â”‚  â”‚
â”‚  â”‚ Variable Name:  DATABASE_URL                    â”‚  â”‚
â”‚  â”‚ Variable Value: postgresql://...                â”‚  â”‚
â”‚  â”‚                                                  â”‚  â”‚
â”‚  â”‚ Variable Name:  EMAIL_HOST                      â”‚  â”‚
â”‚  â”‚ Variable Value: mail.uniquein.lk                â”‚  â”‚
â”‚  â”‚                                                  â”‚  â”‚
â”‚  â”‚ [ Add Variable ]  [ Save ]                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Generated**: January 29, 2026  
**For**: EMS Hostinger Deployment
